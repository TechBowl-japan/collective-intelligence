# DNS and how it works ?  〜DNSとそれがどのように動作するか〜

## DNSとは？

「Domain Name System」の略。
インターネット上でドメイン名というものを管理するために開発されたシステムで、現在のインターネットで必要不可欠なシステム。
ドメイン名とIPアドレスを紐付ける役目をしており、ドメイン名を渡すことでそれに紐づいたIPアドレスが取得できる。

## ドメイン名とは？

インターネットでウェブサイトをみる際に、URLに含まれている `://`と次の `/` の間の部分がドメイン名と呼ばれる。qiitaで言えば `qiita.com`にあたる部分がドメイン名ということになる。
相手がインターネット上のどこいるかを特定するための住所にあたるものとして使われている。

## IPアドレスとは？

インターネットに繋がったコンピュータそれぞれに割り振られた英数字の羅列。
これを用いてコンピューター同士はインターネット上で通信をしている。
ただの英数字では人間が覚えにくいのでIPアドレスに紐づいてドメイン名がつけられる。

## DNSの仕組みとは？

DNSが動いているサーバにアクセスすることでドメイン名からIPアドレスを取得することができるわけだが、DNSサーバ１つが全ての情報を持っているわけではなく、階層構造の複数のサーバで成り立っている。自分の管理するドメインの一部を下位のサーバに管理を任せることでデータを分散している。
最も上位で検索の起点となるサーバをルートサーバと言い、そこから下位のサーバに順に辿っていくことで必要な情報を取得する。

# とまぁここまで説明してきたわけですが実際にやってみた

言葉だけだとよくわからんので実際やってみることにしました。
AWSでRoute53というDNSサーバを作れるサービスがあったのでそれを使って、AWS上にたてたサーバにブラウザからドメイン名でアクセスできるようにしてみました。

## やったこと

### VPC編

* VPCでAWS上にネットワークを構築
* 公開用のパブリックサブネットと非公開用のプライベートサブネットを作成
* インターネットとの接続するためにインターネットゲートウェイを作成
* ルートテーブルを使ってパブリックサブネットとインターネットゲートウェイを接続

### EC2編

* EC2インスタンスの設置
* EC2インスタンスの秘密鍵をローカルに保存
* 秘密鍵の権限を変更（これしないとEC2ログインの鍵として使えない）
  * `chmod 600 秘密鍵のパス`
* EC2インスタンスに秘密鍵を使ってSSHで接続
  * `ssh -i 秘密鍵のパス ログイン時のユーザ名@サーバのIPアドレス`
* EC2インスタンス内でApacheをインストール
* Apacheを使ってサーバを立ち上げる
* HTTPでの通信ができるようにファイアウォールの設定
* ElasticIPアドレスという固定のIPアドレスを取得
* ElasticIPアドレスをEC2インスタンスのIPアドレスに設定

## Route53編

* freenomでフリーのドメインを取得
* Route53でDNSサーバを作成
* ドメインのネームサーバをRoute53に変更
* DNSサーバにAレコードを作成
* EC2インスタンスのElasticIPアドレスをAレコードに追加

ここまでしてブラウザにドメインを入力するとEC2インスタンスのApacheサーバにアクセスできるようになった